#!/usr/bin/with-contenv bash

# make folders
mkdir -p /openvpn{/pid,/sock,/tmp} /dev/net /config/log /config/etc/tmp

# create tun device
if [ ! -c /dev/net/tun ]; then
  mknod /dev/net/tun c 10 200
fi

# copy config or update
if [ -f /openvpn/openvpn.deb ]; then
	echo "installing openvpn"
	rm -rf /usr/local/openvpn_as
	ln -s /config /usr/local/openvpn_as
	dpkg -i /openvpn/openvpn.deb
	rm /openvpn/openvpn.deb
	apt-get clean
	rm -rf /tmp
fi

# clear old sock files
for file in /openvpn/sock/*
	do
		if [ -e "$file" ]; then
		rm -rf "$file"
		fi
	done

# clear old pid files
for file in /openvpn/pid/*
	do
		if [ -e "$file" ]; then
		rm -rf "$file"
		fi
	done


# permissions
chown abc:abc /config/log /config/etc/tmp
chmod -R 755 /openvpn
